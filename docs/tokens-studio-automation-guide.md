# Tokens Studio Automation Guide

## üéØ Complete Automation Setup

This guide shows how to implement **fully automated** design token sync from Tokens Studio to your codebase.

### Current Setup (Manual)
```
Designer updates Tokens Studio ‚Üí Export JSON ‚Üí Manual commit ‚Üí npm run tokens:update
```

### Target Setup (Automated)
```
Designer updates Tokens Studio ‚Üí Auto-push to GitHub ‚Üí Auto-deploy ‚Üí Live updates
```

## üîß Implementation Steps

### 1. Tokens Studio GitHub Integration

**Setup Tokens Studio to auto-push:**

1. **In Tokens Studio (Figma Plugin):**
   - Go to Settings ‚Üí Sync
   - Choose "GitHub" as sync provider
   - Connect your repository
   - Set branch: `main` or `design-tokens`
   - Set file path: `tokens.json`
   - Enable "Auto-push on save"

2. **GitHub Repository Setup:**
   ```bash
   # Create a dedicated branch for design tokens
   git checkout -b design-tokens
   git push -u origin design-tokens
   
   # Set up branch protection rules (optional)
   # Allow Tokens Studio bot to push directly
   ```

### 2. GitHub Actions Automation

**Create `.github/workflows/tokens-sync.yml`:**

```yaml
name: Design Tokens Sync

on:
  push:
    branches: [ design-tokens ]
    paths: [ 'tokens.json' ]
  workflow_dispatch:

jobs:
  sync-tokens:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Update design tokens
      run: npm run tokens:update
    
    - name: Commit updated files
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add .
        git diff --staged --quiet || git commit -m "üé® Update design tokens from Tokens Studio"
    
    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v5
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        branch: tokens-update-${{ github.run_number }}
        title: "üé® Design Tokens Update"
        body: |
          ## Design Tokens Update
          
          This PR contains automated updates from Tokens Studio.
          
          ### Changes:
          - Updated `tokens.json`
          - Regenerated Tailwind config
          - Updated CSS custom properties
          
          ### Review:
          - [ ] Check color changes
          - [ ] Verify spacing updates
          - [ ] Test component rendering
          
          **Auto-generated by Tokens Studio sync**
        base: main
```

### 3. Enhanced Token Update Script

**Update `scripts/update-tokens.js`:**

```javascript
#!/usr/bin/env node

import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const TOKENS_FILE = path.join(__dirname, '../tokens.json');
const TAILWIND_CONFIG = path.join(__dirname, '../tailwind.config.js');
const TOKENS_CSS = path.join(__dirname, '../src/styles/tokens.css');

// Validation and error handling
function validateTokens(tokens) {
  const errors = [];
  
  if (!tokens.colors) errors.push('Missing colors object');
  if (!tokens.spacing) errors.push('Missing spacing object');
  
  return errors;
}

// Generate comprehensive Tailwind config
function generateTailwindConfig(tokens) {
  const colors = {};
  const spacing = {};
  
  // Process colors
  Object.entries(tokens.colors).forEach(([category, shades]) => {
    colors[category] = {};
    Object.entries(shades).forEach(([shade, colorData]) => {
      colors[category][shade] = colorData.value;
    });
  });
  
  // Process spacing
  Object.entries(tokens.spacing).forEach(([key, spaceData]) => {
    spacing[key] = spaceData.value;
  });
  
  return `/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: ${JSON.stringify(colors, null, 6)},
      spacing: ${JSON.stringify(spacing, null, 6)},
      fontFamily: {
        sans: ['DM Sans', 'system-ui', 'sans-serif'],
      },
    },
  },
  plugins: [],
}`;
}

// Generate CSS custom properties
function generateTokensCSS(tokens) {
  let css = ':root {\n';
  
  // Colors
  Object.entries(tokens.colors).forEach(([category, shades]) => {
    Object.entries(shades).forEach(([shade, colorData]) => {
      css += `  --color-${category}-${shade}: ${colorData.value};\n`;
    });
  });
  
  // Spacing
  Object.entries(tokens.spacing).forEach(([key, spaceData]) => {
    css += `  --spacing-${key}: ${spaceData.value};\n`;
  });
  
  css += '}\n';
  return css;
}

// Main execution
async function updateTokens() {
  try {
    console.log('üîÑ Reading tokens.json...');
    const tokensData = JSON.parse(fs.readFileSync(TOKENS_FILE, 'utf8'));
    
    console.log('‚úÖ Validating tokens...');
    const errors = validateTokens(tokensData);
    if (errors.length > 0) {
      throw new Error(`Token validation failed: ${errors.join(', ')}`);
    }
    
    console.log('üé® Generating Tailwind config...');
    const tailwindConfig = generateTailwindConfig(tokensData);
    fs.writeFileSync(TAILWIND_CONFIG, tailwindConfig);
    
    console.log('üìù Generating CSS tokens...');
    const tokensCSS = generateTokensCSS(tokensData);
    fs.writeFileSync(TOKENS_CSS, tokensCSS);
    
    console.log('‚úÖ Design tokens updated successfully!');
    console.log('üìÑ Updated files:');
    console.log('  - tailwind.config.js');
    console.log('  - src/styles/tokens.css');
    
    // Trigger hot reload in development
    if (process.env.NODE_ENV === 'development') {
      console.log('üî• Hot reload triggered');
    }
    
  } catch (error) {
    console.error('‚ùå Error updating tokens:', error.message);
    process.exit(1);
  }
}

updateTokens();
```

### 4. Development Workflow

**Add to `package.json`:**

```json
{
  "scripts": {
    "tokens:update": "node scripts/update-tokens.js",
    "tokens:watch": "chokidar 'tokens.json' -c 'npm run tokens:update'",
    "tokens:validate": "node scripts/validate-tokens.js",
    "dev:tokens": "concurrently 'npm run dev' 'npm run tokens:watch'"
  }
}
```

### 5. Team Integration

**Create `docs/design-tokens-workflow.md`:**

```markdown
# Design Tokens Workflow

## For Designers
1. Update tokens in Tokens Studio (Figma)
2. Save changes (auto-pushes to GitHub)
3. Monitor GitHub for PR creation
4. Review and approve PR

## For Developers
1. Pull latest changes: `git pull origin main`
2. Install dependencies: `npm install`
3. Start development: `npm run dev:tokens`
4. Tokens update automatically when changed

## For DevOps
1. Set up GitHub Actions (already configured)
2. Configure deployment triggers
3. Monitor token validation
4. Set up Slack notifications (optional)
```

## üöÄ Company Implementation

### For Your Company Codebase:

1. **Copy These Files:**
   ```
   scripts/update-tokens.js
   .github/workflows/tokens-sync.yml
   docs/design-tokens-workflow.md
   ```

2. **Package.json Scripts:**
   ```json
   {
     "scripts": {
       "tokens:update": "node scripts/update-tokens.js",
       "tokens:watch": "chokidar 'tokens.json' -c 'npm run tokens:update'",
       "dev:tokens": "concurrently 'npm run dev' 'npm run tokens:watch'"
     }
   }
   ```

3. **Dependencies:**
   ```bash
   npm install --save-dev chokidar concurrently
   ```

4. **Team Setup:**
   - Share Figma file with designers
   - Install Tokens Studio plugin
   - Connect to company GitHub repo
   - Train team on workflow

### Verification Steps:

1. **Test Local Sync:**
   ```bash
   # Edit tokens.json manually
   npm run tokens:update
   # Check if Tailwind config updates
   ```

2. **Test GitHub Integration:**
   ```bash
   # Push tokens.json change
   git add tokens.json
   git commit -m "test: update tokens"
   git push
   # Check if GitHub Action runs
   ```

3. **Test End-to-End:**
   - Update color in Tokens Studio
   - Verify GitHub receives update
   - Check PR is created
   - Merge and verify deployment

## üîê Security Considerations

- Use GitHub App tokens for better security
- Limit Tokens Studio access to specific files
- Set up branch protection rules
- Monitor for unauthorized changes
- Use environment-specific tokens

## üìä Monitoring & Alerts

**Optional Slack Integration:**
```yaml
- name: Notify Slack
  uses: 8398a7/action-slack@v3
  with:
    status: ${{ job.status }}
    text: "Design tokens updated from Tokens Studio"
  env:
    SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}
```

This setup ensures **any change in Tokens Studio automatically flows to your codebase** with proper validation and review processes! 